<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schedule Compression Visualizer</title>
    <!-- We keep Tailwind for layout, but use inline styles for critical visuals -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        .phase-bar { transition: all 0.3s ease; }
        .waterfall-step { transition: all 0.3s ease; cursor: pointer; }
        
        /* Hover Effects */
        .highlight-phase { filter: brightness(1.1); box-shadow: 0 0 15px rgba(0,0,0,0.3); z-index: 20; transform: scaleX(1.05); }
        .dim-phase { opacity: 0.3; filter: grayscale(0.5); }
        
        .tooltip {
            position: absolute;
            background: #0f172a;
            color: white;
            padding: 10px 14px;
            border-radius: 8px;
            font-size: 13px;
            line-height: 1.4;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.15s;
            z-index: 100;
            max-width: 280px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255,255,255,0.1);
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 p-2 md:p-8 min-h-screen flex flex-col items-center">

    <div class="w-full max-w-6xl">
        <header class="mb-6 md:mb-10 text-center mt-4 md:mt-0">
            <h1 class="text-2xl md:text-4xl font-bold text-slate-900 mb-2 md:mb-3 tracking-tight">Mechanisms of Schedule Compression</h1>
            <p class="text-slate-500 text-sm md:text-xl px-4">How Dusty Robotics Enables Parallelization and De-Risking</p>
        </header>

        <!-- Insight Box (Moved to Top) -->
        <div class="mb-8 grid grid-cols-1 md:grid-cols-3 gap-6 w-full">
             <div class="bg-blue-50 border border-blue-100 p-5 rounded-xl col-span-2">
                <h3 class="font-bold text-blue-900 mb-2 flex items-center gap-2 text-sm md:text-base">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    Analysis: The "Shift Left" Effect
                </h3>
                <p class="text-blue-800 text-xs md:text-sm leading-relaxed">
                    Hover over the green waterfall bars. Notice how <span class="font-bold">MEP Rough-In</span> (Light Blue) and <span class="font-bold">Interior Layout</span> (Orange) compress dramatically in the Target stack, while <span class="font-bold">Pre-Construction</span> (Light Grey) actually grows slightly to accommodate the VDC investment.
                </p>
            </div>
             <div class="bg-slate-100 border border-slate-200 p-5 rounded-xl flex flex-col justify-center items-center text-center">
                <span class="text-3xl font-bold text-emerald-600 mb-1">-50%</span>
                <span class="text-slate-600 text-sm font-medium">Schedule Reduction</span>
            </div>
        </div>

        <!-- Main Chart Container -->
        <div class="bg-white p-2 md:p-10 rounded-2xl shadow-xl border border-slate-200 relative">
            
            <!-- Chart Area -->
            <!-- Changed px-12 to px-2 md:px-12 for mobile space -->
            <div id="chart-container" class="relative h-[400px] md:h-[550px] w-full flex items-end justify-between px-2 md:px-12 pb-12 border-b border-slate-200">
                
                <!-- Grid Lines -->
                <div class="absolute inset-0 pointer-events-none flex flex-col justify-between pb-12">
                    <div class="w-full h-px bg-slate-100"></div> <!-- Top -->
                    <div class="w-full h-px bg-slate-100"></div>
                    <div class="w-full h-px bg-slate-100"></div>
                    <div class="w-full h-px bg-slate-100"></div>
                    <div class="w-full h-px bg-slate-200"></div> <!-- Bottom (0) -->
                </div>
                
                <!-- Axis Labels (Hidden on very small screens to save space, or scaled down) -->
                <div class="absolute left-0 top-0 bottom-12 w-6 flex flex-col justify-between text-[10px] md:text-xs font-semibold text-slate-400 py-1 hidden sm:flex">
                    <span>85w</span>
                    <span>60w</span>
                    <span>40w</span>
                    <span>20w</span>
                    <span>0w</span>
                </div>

                <!-- 1. Baseline Stack -->
                <!-- Changed w-32 to w-20 md:w-32 -->
                <div class="relative w-20 md:w-32 flex flex-col-reverse h-full group z-10 flex-shrink-0" id="stack-baseline">
                    <div class="text-center mt-5 absolute -bottom-10 w-full font-bold text-slate-800 text-xs md:text-base">Baseline<br><span class="text-slate-400 font-medium text-[10px] md:text-sm">80 wks</span></div>
                </div>

                <!-- 2. Waterfall Bridge -->
                <!-- Changed mx-6 to mx-1 md:mx-6 to allow expansion -->
                <div class="flex-1 mx-1 md:mx-6 relative h-full z-0 min-w-0" id="waterfall-area">
                    <!-- Steps injected by JS -->
                </div>

                <!-- 3. Target Stack -->
                <!-- Changed w-32 to w-20 md:w-32 -->
                <div class="relative w-20 md:w-32 flex flex-col-reverse h-full z-10 flex-shrink-0" id="stack-target">
                    <div class="text-center mt-5 absolute -bottom-10 w-full font-bold text-blue-600 text-xs md:text-base">Target<br><span class="text-slate-400 font-medium text-[10px] md:text-sm">40 wks</span></div>
                </div>
            </div>

            <!-- Legend -->
            <div class="mt-12 flex flex-wrap gap-x-4 md:gap-x-8 gap-y-3 text-xs md:text-sm justify-center" id="legend"></div>
        </div>

        <div id="tooltip" class="tooltip"></div>
    </div>

<script>
    // --- Data Source ---
    const data = {
        phases: {
            pre_construction: { label: "Pre-Construction", color: "#cbd5e1" }, // Slate 300
            structure: { label: "Structure", color: "#94a3b8" },       // Slate 400
            interior_layout: { label: "Interior Layout", color: "#f59e0b" }, // Amber 500
            mep_rough_in: { label: "MEP Rough-In", color: "#3b82f6" },    // Blue 500
            commissioning: { label: "Commissioning", color: "#1e3a8a" },   // Blue 900
            turnover: { label: "Turnover", color: "#171717" }        // Neutral 900
        },
        baseline: [
            { id: "pre_construction", val: 4 },
            { id: "structure", val: 12 },
            { id: "interior_layout", val: 14 },
            { id: "mep_rough_in", val: 34 },
            { id: "commissioning", val: 12 },
            { id: "turnover", val: 4 }
        ],
        target: [
            { id: "pre_construction", val: 7 }, // increased
            { id: "structure", val: 12 },
            { id: "interior_layout", val: 2 },
            { id: "mep_rough_in", val: 12 },
            { id: "commissioning", val: 3 },
            { id: "turnover", val: 4 }
        ],
        waterfall: [
            { label: "VDC Investment", val: 3, type: "increase", impact: "pre_construction", desc: "We voluntarily add time here to perfect the model, preventing delays later." },
            { label: "Layout Speed", val: -12, type: "decrease", impact: "interior_layout", desc: "Layout speed + multi-trade parallelization: installation can start immediately following the robot instead of having to wait for each trade sequentially to lay out the entire floor." },
            { label: "Parallelization", val: -12, type: "decrease", impact: "mep_rough_in", desc: "Build-Ahead of surrounding systems around critical path items enables parallelization. Equipment delays don't hold up the schedule." },
            { label: "Reduced Congestion", val: -8, type: "decrease", impact: "mep_rough_in", desc: "Better flow: trades work in zones without stacking, speeding up install." },
            { label: "Rework Reduction", val: -6, type: "decrease", impact: "mep_rough_in", desc: "Removes the hidden 'tear-out-and-fix' time embedded in the install phase." },
            { label: "Commissioning De-Risking", val: -5, type: "decrease", impact: "commissioning", desc: "Transforms Commissioning from troubleshooting errors to simple verification." }
        ]
    };

    const CHART_MAX = 85; 
    
    // --- Render Functions ---

    function renderStack(containerId, stackData) {
        const container = document.getElementById(containerId);
        const label = container.querySelector('div');
        container.innerHTML = '';
        container.appendChild(label);
        
        [...stackData].reverse().forEach(item => {
            const heightPct = (item.val / CHART_MAX) * 100;
            const el = document.createElement('div');
            el.className = `phase-bar w-full border-b border-white/20 relative phase-${item.id}`;
            el.style.height = `${heightPct}%`;
            el.style.backgroundColor = data.phases[item.id].color;
            
            el.addEventListener('mouseenter', (e) => {
                showTooltip(e, `
                    <div class="font-bold text-slate-200 mb-1">${data.phases[item.id].label}</div>
                    <div class="text-2xl font-bold">${item.val} <span class="text-sm font-normal text-slate-400">weeks</span></div>
                `);
            });
            el.addEventListener('mousemove', (e) => moveTooltip(e));
            el.addEventListener('mouseleave', hideTooltip);
            
            container.appendChild(el);
        });
    }

    function renderWaterfall() {
        const container = document.getElementById('waterfall-area');
        container.innerHTML = ''; 
        let currentLevel = 80; 
        
        const count = data.waterfall.length;
        const widthPct = 100 / count;

        data.waterfall.forEach((step, idx) => {
            const isIncrease = step.type === 'increase';
            const heightVal = Math.abs(step.val);
            const heightPct = (heightVal / CHART_MAX) * 100;
            
            let bottomVal = isIncrease ? currentLevel : (currentLevel - heightVal);
            let bottomPct = (bottomVal / CHART_MAX) * 100;

            currentLevel = isIncrease ? (currentLevel + heightVal) : (currentLevel - heightVal);

            const elWrapper = document.createElement('div');
            elWrapper.className = 'absolute h-full group';
            elWrapper.style.width = `${widthPct}%`;
            elWrapper.style.left = `${idx * widthPct}%`;
            elWrapper.style.zIndex = 20; 
            
            const bar = document.createElement('div');
            bar.className = 'waterfall-step rounded-sm shadow-sm absolute';
            bar.style.left = '10%'; // More space usage on mobile
            bar.style.width = '80%'; // Wider bars on mobile
            
            bar.style.backgroundColor = isIncrease ? '#ef4444' : '#10b981'; 
            bar.style.height = `${heightPct}%`;
            bar.style.bottom = `${bottomPct}%`; 
            
            const label = document.createElement('div');
            label.className = 'absolute text-[9px] md:text-[11px] font-bold text-slate-500 text-center w-full transition-all duration-200';
            label.style.bottom = `${bottomPct + heightPct + 1}%`;
            label.innerText = step.val > 0 ? `+${step.val}` : step.val;
            
            const title = document.createElement('div');
            title.className = 'hidden md:block absolute opacity-0 group-hover:opacity-100 transition-opacity bg-white border border-slate-200 px-2 py-1 rounded shadow-lg pointer-events-none z-30 whitespace-nowrap left-1/2 transform -translate-x-1/2';
            title.style.bottom = `${bottomPct + heightPct + 15}%`; 
            title.innerHTML = `<span class="text-[10px] font-bold text-slate-700 uppercase tracking-wider">${step.label}</span>`;
            
            elWrapper.appendChild(title);
            elWrapper.appendChild(label);
            elWrapper.appendChild(bar);
            container.appendChild(elWrapper);

            bar.addEventListener('mouseenter', (e) => {
                showTooltip(e, `
                    <div class="font-bold text-emerald-400 mb-1">${step.label}</div>
                    <div class="text-sm text-slate-300 leading-snug">${step.desc}</div>
                `);
                highlightPhase(step.impact);
            });
            bar.addEventListener('mousemove', (e) => moveTooltip(e));
            bar.addEventListener('mouseleave', () => {
                hideTooltip();
                resetHighlights();
            });
        });
    }

    function renderLegend() {
        const leg = document.getElementById('legend');
        leg.innerHTML = '';
        Object.entries(data.phases).forEach(([id, p]) => {
            const item = document.createElement('div');
            item.className = 'flex items-center gap-2 cursor-pointer hover:bg-slate-100 px-2 py-1 rounded transition-colors';
            item.innerHTML = `<div class="w-3 h-3 rounded-sm shadow-sm" style="background-color:${p.color}"></div><span class="text-slate-600 font-medium">${p.label}</span>`;
            
            // Add interactions for highlighting
            item.addEventListener('mouseenter', () => highlightPhase(id));
            item.addEventListener('mouseleave', resetHighlights);
            
            leg.appendChild(item);
        });
    }

    function highlightPhase(phaseId) {
        if(!phaseId || phaseId === 'All') return;
        document.querySelectorAll('.phase-bar').forEach(el => el.classList.add('dim-phase'));
        document.querySelectorAll(`.phase-${phaseId}`).forEach(el => {
            el.classList.remove('dim-phase');
            el.classList.add('highlight-phase');
        });
    }

    function resetHighlights() {
        document.querySelectorAll('.phase-bar').forEach(el => {
            el.classList.remove('dim-phase', 'highlight-phase');
        });
    }

    const tooltip = document.getElementById('tooltip');
    
    function showTooltip(e, html) {
        tooltip.innerHTML = html;
        tooltip.style.opacity = 1;
        moveTooltip(e);
    }
    
    function moveTooltip(e) {
        const x = e.pageX + 15;
        const y = e.pageY - 15;
        tooltip.style.left = x + 'px';
        tooltip.style.top = y + 'px';
    }

    function hideTooltip() {
        tooltip.style.opacity = 0;
    }

    renderStack('stack-baseline', data.baseline);
    renderStack('stack-target', data.target);
    renderWaterfall();
    renderLegend();

</script>
</body>
</html>
